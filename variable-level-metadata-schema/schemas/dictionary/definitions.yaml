csvArray:
  type: string 
  pattern: ^(?:[^|]+\||[^|]*)(?:[^|]*\|)*[^|]*$

csvObject:
  type: string 
  pattern: ^(?:.*?=.*?(?:\||$))+$


# for frictionless types and formats see:
# https://specs.frictionlessdata.io/table-schema/#types-and-formats

# NOTE: The below was excluded from schema to simplify (10/6/2023) and formats is now just type string isntead of anyOf
stringFormat:
  title: String Formats
  description: |
    A format for a specialized type of string of:

    - "`email` if valid emails (e.g., test@gmail.com)"
    - "`uri` if valid uri addresses (e.g., https://example.com/resource123)"
    - "`binary` if a base64 binary encoded string (e.g., authentication token like aGVsbG8gd29ybGQ=)"
    - "`uuid` if a universal unique identifier also known as a guid (eg., f47ac10b-58cc-4372-a567-0e02b2c3d479)"

  enum: 
  - uri 
  - email 
  - binary 
  - uuid

dateFormat:
  title: Date Formats
  type: string
  description: |
    A format for a date variable (`date`,`time`,`datetime`).  
        **default**: An ISO8601 format string.
        **any**: Any parsable representation of a date/time/datetime. The implementing library can attempt to parse the datetime via a range of strategies.
  
    **{PATTERN}**: The value can be parsed according to `{PATTERN}`,
     which `MUST` follow the date formatting syntax of 
     C / Python [strftime](http://strftime.org/) such as:

    - "`%Y-%m-%d` (for date, e.g., 2023-05-25)"
    - "`%Y%-%d` (for date, e.g., 20230525) for date without dashes"
    - "`%Y-%m-%dT%H:%M:%S` (for datetime, e.g., 2023-05-25T10:30:45)"
    - "`%Y-%m-%dT%H:%M:%SZ` (for datetime with UTC timezone, e.g., 2023-05-25T10:30:45Z)"
    - "`%Y-%m-%dT%H:%M:%S%z` (for datetime with timezone offset, e.g., 2023-05-25T10:30:45+0300)"
    - "`%Y-%m-%dT%H:%M` (for datetime without seconds, e.g., 2023-05-25T10:30)"
    - "`%Y-%m-%dT%H` (for datetime without minutes and seconds, e.g., 2023-05-25T10)"
    - "`%H:%M:%S` (for time, e.g., 10:30:45)"
    - "`%H:%M:%SZ` (for time with UTC timezone, e.g., 10:30:45Z)"
    - "`%H:%M:%S%z` (for time with timezone offset, e.g., 10:30:45+0300)"


geojsonFormat:
  title: Geojson Formats
  type: string
  description: The JSON object according to the geojson spec.
  enum: [topojson,default]

geopointFormat:
  title: Geopoint Format
  type: string
  description: |
    The two types of formats for `geopoint` (describing a geographic point).

    - `array` (if 'lat,long' (e.g., 36.63,-90.20))
    - `object` (if {'lat':36.63,'lon':-90.20})
  enum: [array,object]

standardsMappingsInstrumentObject:
    type: object
    title: Standard mapping - instrument
    description: |
      A standardized set of items which encompass 
      a variable in this variable level metadata document (if at the root level or the document level) 
      or the individual variable (if at the field level). 
      

      !!! note "NOTE"

        If information is present at both the root and the field level, 
        then the information at the field level would take precedence (i.e., it would cascade).

    properties:
      url:
        type: string
        format: uri
      source:
        type: string
        enum: ["heal-cde"]
      title:
        type: string
      id:
        type: string

rootStandardsMappingsItem:
  type: object
  description: |
    A set of standardized instruments linked to all variables within the `fields` property (but see note).
    
    !!! note "NOTE"

      If `standardsMappings` is present at both the root (this property) and within `fields`, 
      then the `fields` `standardsMappings` property takes precedence.

      Note, only instrument can be mapped to this property as opposed to the `fields` `standardsMappings`
      This property has the same specification as the `fields` `standardsMappings` to make the cascading logic
      easier to understand in the same way other standards implement cascading 
      (e.g., `missingValues` in the [frictionless specification](https://specs.frictionlessdata.io/patterns/#missing-values-per-field))

  properties:
    instrument:
      $ref: "#/definitions/standardsMappingsInstrumentObject"


fieldStandardsMappingsItem:
  type: object
  description: |

    A set of instrument and item references to standardized data elements designed to document
    the [HEAL common data elements program](https://heal.nih.gov/data/common-data-elements)
    and other standardized/common element sources to facilitate cross-study comparison and interoperability
    of data. One can either map an individual data element or an instrument in which the field is 
    a part of.
    
    __**All Fields Mapped (Both Instrument and Item)**__

    ```json
    "standardsMappings": [
        {
            "instrument": {
                "url": "https://www.heal.nih.gov/files/CDEs/2023-05/adult-demographics-cdes.xlsx",
                "source": "heal-cde",
                "title": "adult-demographics",
                "id": <drupal id here>
            },
            "item": {
                "url": "https://evs.nci.nih.gov/ftp1/CDISC/SDTM/SDTM%20Terminology.html#CL.C74457.RACE",
                "source": "CDISC",
                "id": "C74457"
            }
        }
    ]
    ```

    __**Only Instrument Title of Form CDE File Mapped**__

    In this scenario, especially as CDE variables do not have associated CDISC ids listed, only instrument information is given.

    ```json
    "standardsMappings": [
        {
            "instrument": {
                "source": "heal-cde",
                "title": "adult-demographics"
            }
        }
    ]
    ```

    __**Only Instrument ID of HEAL CDE Mapped**__

    ```json
    "standardsMappings": [
        {
            "instrument": {
                "source": "heal-cde",
                "id": <drupal id here>
            }
        }
    ]
    ```

    __**Other Non-HEAL CDE Use Cases**__

    Only item matched (for example if found in the NIH (not HEAL) CDE repository). Folks would enter the information in the "Identifier" section. Similar to the above, they could also just enter the "url".

    ```json
    "standardsMappings": [
        {
            "item": {
                "source": "NLM",
                "id": "Fakc6Jy2x"
            }
        }
    ]
    ```

    __**Multiple CDE Mappings**__

    Two separate records. If desired, multiple standard mappings can be entered, say from the NIH HEAL CDE repo and the NIH CDE lookup (NLM) by way of two separate records in the list.

    ```json
    "standardsMappings": [
        {
            "instrument": {
                "source": "heal-cde",
                "title": "adult-demographics"
            },
            "item": {
                "source": "CDISC",
                "id": "C74457"
            },
        },
        {
            "item": {
                "source": "NLM",
                "id": "Fakc6Jy2x"
            }
        }
    ]
    ```
  properties:
    instrument:
      $ref: "#/definitions/standardsMappingsInstrumentObject"


    item:
      type: object
      title: Standard mapping - item
      description: |
        A standardized item (ie field, variable etc) mapped to this individual variable.
      properties:
        url:
          title: Standards Mapping - Url
          description: |
            The url that links out to the published, standardized mapping.
          type: string
          format: uri
          examples:
            - https://cde.nlm.nih.gov/deView?tinyId=XyuSGdTTI
        source:
          title: Standard Mapping - Source 
          description: |
            The source of the standardized variable.
          type: string
        id:
          title: Standard Mapping - Id
          type: string
          description: |
            The id locating the individual mapping within the given source.

